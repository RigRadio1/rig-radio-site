<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rig-Radio | Dashboard</title>
  <link rel="icon" href="/favicon.ico">
  <style>
    :root { --bg:#0b0b0c; --panel:#121214; --border:#1e1e22; --muted:#cfd2d7; --text:#fff; --accent:#D90429; }
    *{ box-sizing:border-box } html,body{ height:100% }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; display:flex; flex-direction:column }
    header{ padding:14px 18px; border-bottom:1px solid #222; display:flex; align-items:center; gap:12px }
    header h1{ margin:0; font-size:1.1rem }
    #auth-quick{ margin-left:auto }
    main{ flex:1; padding:24px; max-width:1000px; margin:0 auto; display:grid; gap:18px }
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:16px }
    .btn{ display:inline-block; padding:8px 12px; border-radius:10px; background:var(--accent); color:#fff; text-decoration:none; font-weight:700; margin-right:8px }
    .status{ margin-top:10px; color:var(--muted) }
    .status.ok{ color:#84d88a }
    .status.err{ color:#ff6b6b }
  </style>
    <link rel="stylesheet" href="/rr.css">
</head>
<body>
  <header>
    <h1>Rig-Radio Dashboard</h1>
    <span id="auth-quick"></span>
  </header>

  <main>
    <div class="card">
      <div>Quick Links:
        <a class="btn" href="/teaser">Teaser</a>
        <a class="btn" href="/submit">Submit</a>
        <a class="btn" href="/library">Library</a>
        <a class="btn" href="/profile">Profile</a>
      </div>
      <div id="sb-status" class="status">Checking Supabaseâ€¦</div>
    </div>
  </main>

  <!-- Scripts (order matters) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="/rr-supabase.js?v=11"></script>
  <script src="/auth.js"></script>
  <script>
    // Require login & show quicklink
    rrRequireAuth('/login.html');
    rrShowAuthQuicklink();

    // rrTest that RETURNS A PROMISE
    window.rrTest = async function rrTest(){
      try{
        if(!window.supabase) return {ok:false,error:'supabase SDK not loaded'};
        const { data, error } = await supabase.auth.getUser();
        if(error) return {ok:false,error:error.message||'auth.getUser error'};
        return {ok:true,user:(data&&data.user)||null};
      }catch(e){ return {ok:false,error:(e&&e.message)?e.message:String(e)}; }
    };

    // Status panel logic (await to avoid race errors)
    (async function(){
      const box = document.getElementById('sb-status');
      const ok  = m => { box.classList.remove('err'); box.classList.add('ok');  box.textContent = 'OK: ' + m; };
      const err = m => { box.classList.remove('ok');  box.classList.add('err'); box.textContent = 'ERROR: ' + m; };

      if (typeof window.supabase === 'undefined') { err('window.supabase undefined (CDN blocked?)'); return; }
      if (typeof window.rigSupabase === 'undefined') { err('window.rigSupabase undefined (/rr-supabase.js missing?)'); return; }

      const res = await window.rrTest();
      if (res && res.ok) ok('Connected to Supabase.');
      else err(res && res.error ? res.error : 'rrTest failed');
    })();
  </script>
</body>
</html>

